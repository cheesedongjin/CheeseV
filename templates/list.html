<h1>{{ title }}</h1>
<div class="search-controls">
    <input id="search-input" type="text" placeholder="Search by title">
    <select id="sort-select">
        <option value="alpha">A-Z</option>
    </select>
</div>
<div id="items">
    {{ categories_content }}
</div>
<script>
    function levenshtein(a, b) {
        const m = a.length, n = b.length;
        const dp = Array.from({ length: m + 1 }, () => Array(n + 1).fill(0));
        for (let i = 0; i <= m; i++) dp[i][0] = i;
        for (let j = 0; j <= n; j++) dp[0][j] = j;
        for (let i = 1; i <= m; i++) {
            for (let j = 1; j <= n; j++) {
                dp[i][j] = Math.min(
                    dp[i - 1][j] + 1,
                    dp[i][j - 1] + 1,
                    dp[i - 1][j - 1] + (a[i - 1] === b[j - 1] ? 0 : 1)
                );
            }
        }
        return dp[m][n];
    }

    const container = document.getElementById('items');
    const list = document.createElement('ul');
    const items = Array.from(container.querySelectorAll('li'));
    container.innerHTML = '';
    list.append(...items);
    container.appendChild(list);

    const searchInput = document.getElementById('search-input');
    const sortSelect = document.getElementById('sort-select');

    function applySort(a, b, sort) {
        if (sort === 'alpha') {
            return a.dataset.title.localeCompare(b.dataset.title);
        }
        return 0;
    }

    function update() {
        const query = searchInput.value.trim().toLowerCase();
        const sort = sortSelect.value;
        const scored = items.map(li => ({
            el: li,
            dist: query ? levenshtein(query, li.dataset.title.toLowerCase()) : 0
        }));
        scored.sort((a, b) => {
            if (query && a.dist !== b.dist) return a.dist - b.dist;
            return applySort(a.el, b.el, sort);
        });
        list.innerHTML = '';
        scored.forEach(item => list.appendChild(item.el));
    }

    searchInput.addEventListener('input', update);
    sortSelect.addEventListener('change', update);
    update();
</script>
